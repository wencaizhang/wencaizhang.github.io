---
title: 高效清理：使用 shell 脚本自动删除所有子目录下的指定文件
date: "2023-03-22"
tags: ["shell", "bash"]
draft: false
summary: "清理系统中不需要的文件是维护系统健康的重要步骤之一。然而，手动删除文件可能会变得十分繁琐，**特别是当这些文件存储在许多子目录中时**。为了解决这个问题，我们可以使用 shell 脚本来高效地清理指定文件。"
images: ["/static/images/img.jpg"]
authors: ["default"]
---


## 背景

清理系统中不需要的文件是维护系统健康的重要步骤之一。然而，手动删除文件可能会变得十分繁琐，**特别是当这些文件存储在许多子目录中时**。为了解决这个问题，我们可以使用 shell 脚本来高效地清理指定文件。

## 核心命令

我主要是使用了 `find` 命令。这个命令能够对文件和目录进行**深度遍历**，因此可以帮助我们轻松地清理整个目录树。


这里做一个简单介绍，想深入了解 find 命令更多参数可以参考 [Linux find 命令 | 菜鸟教程 (runoob.com)](https://www.runoob.com/linux/linux-comm-find.html)


`find` 命令示范：

```sh
find . -type f -name "*.txt" -delete
```

这个命令的作用是查找当前目录及其所有子目录中扩展名为 `txt` 的文件，并将它们全部删除。

其中：
- `find` 后面的 `.` 代表当前目录；
- `-type f` 表示只搜索文件（不包括目录）；
- `-name` 用于指定文件名模式（在这里是 `*.txt` ），既可以使用正则匹配也可以使用具体文件名匹配；
- 最后的 `-delete` 参数告诉 `find` 命令删除所有匹配到的文件。

当然了如果你想删除其他类型的文件，只需将 `.txt` 替换为相应的文件类型即可，或者直接指定具体的文件名称也可以。

## 实现

为了以后可以重复执行这个工作，可以把命令写到 shell 脚本文件，这里创建一个 `clean.sh` 文件，并在其中输入以下代码：


```sh
#!/bin/bash

find . -type f -name "*.txt" -delete
```

然后给这个文件赋予可执行的权限:

```bash
chmod +x ./clean.sh
```

当你保存并运行这个脚本时，它将自动扫描整个目录下的所有子目录，找到包含“txt”扩展名的所有文件并将它们全部删除。通过这种方式，我们可以快速有效地清理文件，无需逐个删除每个文件或手动浏览整个目录树。

总之，使用 shell 脚本自动清理指定类型的文件是一个非常高效的方法。这种方法可以减少你的工作量和时间，并且确保你的系统保持健康和干净。



## 最终结果

```bash
#!/bin/bash

# 指定要在哪个目录下执行脚本
work_dir_name="/Users/wencai/other"

# 指定要在哪个目录下执行脚本
# 可以在执行脚本的后面跟上路径，如果没有则为 ./
# work_dir_name=${1:-./}

# 所有要删除的文件，注意格式：双引号包裹，空格隔开
my_array=(
  "图片.png"
  "压缩包.zip"
  "视频.mp4"
)

for i in "${my_array[@]}"
do
  # sed 将路径中的空格进行转义
  find $work_dir_name -name "$i" | sed 's/ /\\ /g' | xargs rm -f
  # echo 删除文件: $i
done
```